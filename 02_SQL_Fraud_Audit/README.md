# SQL Fraud Audit: Post-Transaction Monitoring âš–ï¸

This project implements a **Rule-Based Audit System** using SQL to detect financial fraud patterns that often bypass real-time filters. It simulates a nightly batch process to identify **Structuring (Smurfing)** and **Velocity Abuse** in transaction logs.

---

## ğŸ“‚ Dataset: PaySim Simulation

This project is built upon the schema of the **[PaySim Mobile Money Dataset](https://www.kaggle.com/datasets/ealaxi/paysim1)**.

> **Note on Data Strategy:**
> The full PaySim dataset contains **~6 million rows (250MB+)**, which exceeds GitHub's limits and is impractical for a portable portfolio.
>
> Instead, I built a **Simulation Engine** (`src/setup_audit_db.py`) that:
>
> 1.  Replicates the exact PaySim schema (`step`, `type`, `amount`, `nameOrig`, etc.).
> 2.  Injects specific adversarial patterns (Structuring & Bots) for validation.
> 3.  Generates a lightweight **SQLite database** locally for immediate auditing.

---

## ğŸ•µï¸â€â™‚ï¸ Audit Logic

The system executes the following checks against the `paysim_transactions` table:

### 1. Structuring Detection (Smurfing)

- **Objective:** Identify users evading the **$10,000 reporting threshold** (AML Red Flag).
- **Logic:** Filter for `CASH_OUT` transactions between **$9,000 and $9,999**. Group by user to find repeated attempts.
- **SQL Source:** `sql/1_structuring_alert.sql`

### 2. Velocity Abuse (Bot Activity)

- **Objective:** Detect automated scripts draining accounts or testing stolen credentials.
- **Logic:** Count transactions per user per time-step (1 hour). Alert if **> 15 TXs/hour**.
- **SQL Source:** `sql/2_velocity_alert.sql`

---

## ğŸ’» Sample Output

When running the audit script, the system flags the following anomalies:

[AUDIT SYSTEM] Running Post-Transaction SQL Analysis...

[ALERT 1] Scanning for Structuring (Smurfing < $10k Limit)...
User_ID Tx_Count Total_Laundered
0 C_SMURF_01 5 49723.45

[ALERT 2] Scanning for Velocity Abuse (>15 TXs/Hour)...
User_ID Hour_Step Velocity_Count
0 C_BOT_99 14 25

---

## ğŸš€ How to Run

1.  **Generate the Database:**

    ```
    python src/setup_audit_db.py
    ```

    _(Creates `data/paysim_audit.db` with simulated fraud)_

2.  **Run the Audit:**
    ```
    python src/run_audit.py
    ```
    _(Executes the SQL logic and prints the flagged users)_

---

## ğŸ› ï¸ Tech Stack

- **Python:** Data Simulation & Orchestration
- **SQLite:** Relational Database Engine
- **Pandas:** Reporting & Data formatting
- **SQL:** Aggregation & filtering logic

---

## ğŸ“‚ Project Structure

02_SQL_Fraud_Audit/
â”œâ”€â”€ data/
â”‚ â”œâ”€â”€ .gitkeep # Placeholder (DB is generated locally)
â”‚ â””â”€â”€ (paysim_audit.db) # SQLite DB generated by setup script
â”‚
â”œâ”€â”€ sql/
â”‚ â”œâ”€â”€ 1_structuring_alert.sql # SQL Logic: Smurfing detection
â”‚ â””â”€â”€ 2_velocity_alert.sql # SQL Logic: High-velocity bot detection
â”‚
â”œâ”€â”€ src/
â”‚ â”œâ”€â”€ setup_audit_db.py # ETL: Simulates PaySim data & loads DB
â”‚ â””â”€â”€ run_audit.py # Execution: Runs queries & reports alerts
â”‚
â”œâ”€â”€ README.md # Documentation
â””â”€â”€ requirements.txt # Project dependencies

---

**Santiago Torterolo**
[LinkedIn Profile](https://linkedin.com/in/santiago-torterolo-5u)
